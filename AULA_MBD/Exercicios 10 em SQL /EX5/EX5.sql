CREATE DATABASE EX5_SQL;

CREATE TABLE FORNECEDOR (
  FOR_INT_ID INTEGER  NOT NULL IDENTITY(1,1) ,
  FOR_STR_NOME VARCHAR(70),
  FOR_INT_TELEFONE INTEGER,
  FOR_INT_CNPJ INTEGER,
 CONSTRAINT PK_FOR_INT_ID PRIMARY KEY(FOR_INT_ID),
 CONSTRAINT UK_FOR_INT_TELEFONE UNIQUE (FOR_INT_TELEFONE),
 CONSTRAINT UK_FOR_CNPJ UNIQUE(FOR_INT_CNPJ),
 );


 SELECT * FROM FORNECEDOR


CREATE TABLE CATEGORIA (
  CAT_INT_ID INTEGER  NOT NULL IDENTITY(1,1) ,
  CAT_STR_DESCRICAO VARCHAR(70)      ,
CONSTRAINT PK_CAT_INT_ID PRIMARY KEY(CAT_INT_ID)
);


CREATE TABLE PRODUTOS (
  PRO_INT_ID INTEGER  NOT NULL  IDENTITY(1,1) ,
  FOR_INT_ID INTEGER  NOT NULL,
  PRO_STR_DESCRICAO VARCHAR(70),
  PRO_INT_QUANTIDADE_ESTOQUE INTEGER,
CONSTRAINT PK_PRO_INT_ID PRIMARY KEY(PRO_INT_ID),
  CONSTRAINT FK_PRODUTO_FORNECEDOR FOREIGN KEY(FOR_INT_ID)
    REFERENCES FORNECEDOR(FOR_INT_ID)
)


CREATE TABLE ESTOQUE (
  EST_INT_ID INTEGER  NOT NULL IDENTITY(1,1) ,
  PRO_INT_ID INTEGER  NOT NULL,
  EST_INT_QUANTIDADE INTEGER,
  EST_INT_ESTOQUE_MINIMO INTEGER,
PRIMARY KEY(EST_INT_ID),
  FOREIGN KEY(PRO_INT_ID)
    REFERENCES PRODUTOS(PRO_INT_ID));

CREATE TABLE SOLICITACAO_COMPRA (
  SOL_INT_ID INTEGER  NOT NULL IDENTITY(1,1) ,
  FOR_INT_ID INTEGER  NOT NULL,
  EST_INT_ID INTEGER  NOT NULL,
  SOL_STR_STATUS VARCHAR(70) ,
   SOL_INT_QUANTIDADE INTEGER ,
  SOL_DAT_DATA DATE,
CONSTRAINT PK_SOL_INT_ID PRIMARY KEY(SOL_INT_ID),
 CONSTRAINT FK_FORNECEDOR_SOLICAITACAO FOREIGN KEY(FOR_INT_ID)
    REFERENCES FORNECEDOR(FOR_INT_ID),
 CONSTRAINT FK_ESSTOQUE_SOLICITACAO FOREIGN KEY(EST_INT_ID)
    REFERENCES ESTOQUE(EST_INT_ID));



CREATE TABLE PRODUTO_CATEGORIA (
  CAT_INT_ID INTEGER  NOT NULL  ,
  PRO_INT_ID INTEGER  NOT NULL      ,
CONSTRAINT FK_PRODUTOS_PRODUTO_CATEGORIA  FOREIGN KEY(PRO_INT_ID)
    REFERENCES PRODUTOS(PRO_INT_ID),
CONSTRAINT FK_CATEGORIA_PRODUTOS_CATEGORIA  FOREIGN KEY(CAT_INT_ID)
    REFERENCES CATEGORIA(CAT_INT_ID));



CREATE TABLE ESTOQUE_CATEGORIA (
  EST_INT_ID INTEGER  NOT NULL  ,
  CAT_INT_ID INTEGER  NOT NULL      ,
CONSTRAINT FK_ESTOQUE_ESTOQUE_CATEGORIA  FOREIGN KEY(EST_INT_ID)
    REFERENCES ESTOQUE(EST_INT_ID),
 CONSTRAINT FK_CATEGORIA_ESTOQUE_CATEGORIA FOREIGN KEY(CAT_INT_ID)
    REFERENCES CATEGORIA(CAT_INT_ID));

	INSERT INTO FORNECEDOR (FOR_STR_NOME, FOR_INT_TELEFONE, FOR_INT_CNPJ)
	VALUES('Jorge',1149699,62311432)

	INSERT INTO FORNECEDOR (FOR_STR_NOME , FOR_INT_TELEFONE , FOR_INT_CNPJ)
	VALUES ('Fornecedor B', 222222222, 987654321),
		   ('Fornecedor C', 333333333, 192837465);
		  


INSERT INTO CATEGORIA (CAT_STR_DESCRICAO) VALUES
('Eletrônicos'),
('Alimentos'),
('Limpeza');


INSERT INTO PRODUTOS (FOR_INT_ID, PRO_STR_DESCRICAO, PRO_INT_QUANTIDADE_ESTOQUE) VALUES
(1, 'Monitor LCD', 50),
(2, 'Arroz 5kg', 200),
(3, 'Detergente', 150);

INSERT INTO ESTOQUE (PRO_INT_ID, EST_INT_QUANTIDADE, EST_INT_ESTOQUE_MINIMO) VALUES
(1, 50, 10),
(2, 200, 30),
(3, 150, 20);

INSERT INTO SOLICITACAO_COMPRA (FOR_INT_ID, EST_INT_ID, SOL_STR_STATUS, SOL_INT_QUANTIDADE, SOL_DAT_DATA) VALUES
(1, 1, 'Pendente', 20, '2025-05-01'),
(2, 2, 'Aprovado', 100, '2025-05-10'),
(3, 3, 'Entregue', 50, '2025-05-15');

INSERT INTO PRODUTO_CATEGORIA (CAT_INT_ID, PRO_INT_ID) VALUES
(1, 1), -- Monitor LCD -> Eletrônicos
(2, 2), -- Arroz 5kg -> Alimentos
(3, 3); -- Detergente -> Limpeza

INSERT INTO ESTOQUE_CATEGORIA (EST_INT_ID, CAT_INT_ID) VALUES
(1, 1),
(2, 2),
(3, 3);

 SELECT * FROM FORNECEDOR
SELECT * FROM CATEGORIA
SELECT * FROM PRODUTOS
SELECT * FROM ESTOQUE
SELECT * FROM SOLICITACAO_COMPRA
SELECT * FROM PRODUTO_CATEGORIA
SELECT * FROM ESTOQUE_CATEGORIA

SELECT 
P.PRO_STR_DESCRICAO AS Produto,
P.PRO_INT_ID ,
F.FOR_STR_NOME AS Fornecedor
FROM PRODUTOS P 
INNER JOIN FORNECEDOR F ON F.FOR_INT_ID	 = F.FOR_INT_ID

SELECT 
C.CAT_STR_DESCRICAO AS CATEGORIA,
P.PRO_STR_DESCRICAO AS PRODUTO
FROM PRODUTO_CATEGORIA PD 
INNER JOIN CATEGORIA C ON PD.CAT_INT_ID = C.CAT_INT_ID
INNER JOIN PRODUTOS P ON PD.PRO_INT_ID = P.PRO_INT_ID


UPDATE FORNECEDOR
SET FOR_STR_NOME = 'Maria'
WHERE FOR_INT_ID = 1 

UPDATE FORNECEDOR
SET FOR_STR_NOME = 'FornecedorA'
WHERE FOR_INT_ID = 1

SELECT * FROM FORNECEDOR