CREATE DATABASE BD_EX2;

CREATE TABLE CLIENTE( 
		CLI_INT_ID INT NOT NULL IDENTITY(1,1),
		CLI_STR_NOME VARCHAR(70),
		CLI_STR_CPF VARCHAR(70),
		CLI_INT_DATANACIMENTO DATE,
		CLI_STR_EMAIL VARCHAR(70),
		CLI_INT_TELEFONE INT,
		CONSTRAINT PK_CLI_ID PRIMARY KEY(CLI_INT_ID),
		CONSTRAINT UK_CLI_STR_EMAIL UNIQUE (CLI_STR_EMAIL),
		CONSTRAINT UK_CLI_STR_CPF UNIQUE (CLI_STR_CPF),
		CONSTRAINT UK_CLI_INT_TELEFONE UNIQUE (CLI_INT_TELEFONE))

ALTER TABLE CLIENTE
ADD END_INT_ID INT NOT NULL,
CONSTRAINT FK_ENDERECO_CLIENTE_ID FOREIGN KEY(END_INT_ID)
	REFERENCES ENDERECO(END_INT_ID)


CREATE TABLE ESTADO(
	EST_INT_ID INT NOT NULL IDENTITY(1,1),
	EST_STR_DESC VARCHAR(70),
	EST_STR_SIGLA CHAR(2),
	CONSTRAINT PK_ESTADO_ID  PRIMARY KEY(EST_INT_ID)
) 


CREATE TABLE CIDADE (
	CID_INT_ID INT NOT NULL IDENTITY(1,1),
	CID_STR_DESC VARCHAR(70),
	EST_INT_ID INT NOT NULL,
	CONSTRAINT PK_CIDADE_ID  PRIMARY KEY(CID_INT_ID),
	CONSTRAINT FK_CIDADE_ESTADO_ID FOREIGN KEY(EST_INT_ID)
	REFERENCES ESTADO(EST_INT_ID)
)


CREATE TABLE ENDERECO (
	END_INT_ID INT NOT NULL IDENTITY(1,1),
	END_STR_RUA VARCHAR(70),
	END_STR_BAIRO VARCHAR(70),
	END_INT_CEP INT,
	CID_INT_ID INT NOT NULL,
	CONSTRAINT PK_ENDERECO_ID  PRIMARY KEY(END_INT_ID),
	CONSTRAINT FK_ENDERECO_CIDADE_ID FOREIGN KEY(CID_INT_ID)
	REFERENCES CIDADE(CID_INT_ID)
)

CREATE TABLE PEDIDO_VENDA(
	PEV_INT_ID INT NOT NULL IDENTITY(1,1),
	PEV_INT_DATE DATETIME,
	PEV_INT_NUMERO INT,
	CONSTRAINT PK_PEDIDO_ID  PRIMARY KEY(PEV_INT_ID),
)

ALTER TABLE PEDIDO_VENDA
ADD CLI_INT_ID INT NOT NULL,
CONSTRAINT FK_PEDIDO_VENDA_CLIENTE_ID FOREIGN KEY(CLI_INT_ID)
	REFERENCES CLIENTE(CLI_INT_ID)

ALTER TABLE PEDIDO_VENDA
ADD PEV_DEC_TOTAL DECIMAL

CREATE TABLE PRODUTOS(
	PRO_INT_ID INT NOT NULL IDENTITY(1,1),
	PRO_DEC_PRECO DECIMAL,
	PRO_STR_NOME VARCHAR(70),
	PRO_INT_CODIGOBARRAS INT
	CONSTRAINT PK_PRODUTO_ID  PRIMARY KEY(PRO_INT_ID),
	CONSTRAINT UK_PRO_INT_CODIGOBARRAS UNIQUE (PRO_INT_CODIGOBARRAS),
)

ALTER TABLE PRODUTOS
ADD NOT_INT_ID INT NOT NULL,
CONSTRAINT FK_NOTA_FISCAL_PRODUTOS FOREIGN KEY(NOT_INT_ID)
REFERENCES NOTA_FISCAL(NOT_INT_ID)

CREATE TABLE CARGO (
	CAR_INT_ID INT NOT NULL IDENTITY(1,1),
	CAR_STR_DESC VARCHAR(70),
	CONSTRAINT PK_CAR_INT_ID PRIMARY KEY(CAR_INT_ID),
	CONSTRAINT UK_CARGO_STR_DESC UNIQUE(CAR_STR_DESC)
)



CREATE TABLE FUNCIONARIO (
	FUN_INT_ID INT NOT NULL IDENTITY(1,1),
	FUN_STR_NOME VARCHAR(70),
	FUN_INT_CPF INT,
	CAR_INT_ID INT NOT NULL,
	CONSTRAINT PK_FUN_INT_ID PRIMARY KEY (FUN_INT_ID),
	CONSTRAINT UK_FUN_INT_CPF UNIQUE(FUN_INT_CPF)
)

ALTER TABLE FUNCIONARIO
ADD CONSTRAINT FK_FUNCIONARIO_CARGO FOREIGN KEY(CAR_INT_ID)
	REFERENCES CARGO(CAR_INT_ID)

CREATE TABLE VENDA (
FUN_INT_ID INT NOT NULL,
PRO_INT_ID INT NOT NULL,
PEV_INT_ID INT NOT NULL,
CONSTRAINT FK_PEDIDO_VENDA_VENDA FOREIGN KEY(PEV_INT_ID)
	REFERENCES PEDIDO_VENDA(PEV_INT_ID),
CONSTRAINT FK_PRODUTO_VENDA FOREIGN KEY(PRO_INT_ID)
	REFERENCES PRODUTOS(PRO_INT_ID),
CONSTRAINT FK_FUNCIONARIO_VENDA FOREIGN KEY(FUN_INT_ID)
	REFERENCES FUNCIONARIO(FUN_INT_ID)
)

CREATE TABLE NOTA_FISCAL (
	NOT_INT_ID INT NOT NULL IDENTITY(1,1),
	NOT_INT_RESGISTRO INT,
	CONSTRAINT PK_NOT_INT_ID PRIMARY KEY(NOT_INT_ID),
	CONSTRAINT UK_NOT_INT_RESGISTRO UNIQUE(NOT_INT_RESGISTRO)
)


CREATE TABLE CATEGORIA (
	CAT_INT_ID INT NOT NULL IDENTITY(1,1),
	CAT_STR_DESC VARCHAR(70),
	CONSTRAINT PK_CAT_INT_ID PRIMARY KEY (CAT_INT_ID),
	CONSTRAINT UK_CAT_STR_DESC UNIQUE(CAT_STR_DESC)
)



CREATE TABLE PRODUTO_CATEGORIA (
CAT_INT_ID INT NOT NULL,
PRO_INT_ID INT NOT NULL,
CONSTRAINT FK_PEDIDO_CATEGORIA_CATEGORIA FOREIGN KEY(CAT_INT_ID)
	REFERENCES CATEGORIA(CAT_INT_ID),
CONSTRAINT FK_PRODUTO_CATEGORIA FOREIGN KEY(PRO_INT_ID)
	REFERENCES PRODUTOS(PRO_INT_ID),
)